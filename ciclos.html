<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa de Ciclos Personales</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:#06101f;color:#e9f1ff}
    .card{background:rgba(12,22,40,0.8);border:1px solid #1e2a44;border-radius:16px;padding:12px}
    .chip{display:flex;justify-content:space-between;gap:8px;padding:8px 10px;border:1px solid #1e2a44;background:rgba(14,22,40,0.8);border-radius:12px}
  </style>
</head>
<body class="min-h-screen">
  <div id="root" class="max-w-6xl mx-auto p-4"></div>

  <script type="text/babel">
    const pad2=n=>String(n).padStart(2,'0');

    function biorhythm(birth, target=new Date()){
      const days = (target - birth)/(1000*60*60*24);
      const phys=Math.sin(2*Math.PI*days/23), emo=Math.sin(2*Math.PI*days/28), intel=Math.sin(2*Math.PI*days/33);
      const pct=x=>Math.round((x*0.5+0.5)*100);
      return {phys:pct(phys),emo:pct(emo),intel:pct(intel)};
    }
    const zodiacWest = d=>{
      const m=d.getUTCMonth()+1, day=d.getUTCDate();
      const cuts=[120,219,321,420,521,621,723,823,923,1023,1122,1222], names=['Cap','Acu','Pis','Aries','Tau','Gem','Cán','Leo','Vir','Lib','Esc','Sag'];
      const md=m*100+day; let i=cuts.findIndex(c=>md<c); if(i<0) i=0; return names[i];
    };
    const chinese = y => ['Rata','Buey','Tigre','Conejo','Dragón','Serpiente','Caballo','Cabra','Mono','Gallo','Perro','Cerdo'][(y-1900)%12];
    const moonPhase = d => {
      const lp=2551443; const new_moon=Date.UTC(2001,0,1)/1000; const now=d.getTime()/1000;
      const phase=((now-new_moon)%lp)/lp; return Math.round(phase*100)+'%';
    };

    function loadState(){
      try{ return JSON.parse(localStorage.getItem('ciclos_state')||'{}'); }catch{ return {}; }
    }
    function saveState(s){ localStorage.setItem('ciclos_state', JSON.stringify(s)); }

    function App(){
      const [name,setName]=React.useState(loadState().name||'');
      const [date,setDate]=React.useState(loadState().date||'1976-12-04');
      const [time,setTime]=React.useState(loadState().time||'00:43');
      const [tz,setTz]=React.useState(loadState().tz||'-03:00');
      const [target,setTarget]=React.useState(loadState().target||new Date().toISOString().slice(0,10));

      React.useEffect(()=>{ saveState({name,date,time,tz,target}); },[name,date,time,tz,target]);

      const birth = new Date(`${date}T${time}:00${tz}`);
      const when  = new Date(`${target}T12:00:00${tz}`);
      const bio = biorhythm(birth, when);

      const topDays = Array.from({length:30},(_,i)=>{
        const d = new Date(when); d.setDate(when.getDate()+i);
        const b = biorhythm(birth,d);
        const avg = Math.round((b.phys+b.emo+b.intel)/3);
        return {date:d.toISOString().slice(0,10), ...b, avg};
      }).sort((a,b)=>b.avg-a.avg).slice(0,5);

      return (
        <div className="space-y-4">
          <header className="flex items-center justify-between">
            <h1 className="text-xl font-semibold">Mapa de Ciclos Personales</h1>
            <div className="chip"><span>Carácter lúdico/educativo</span><span className="text-green-400">No médico</span></div>
          </header>

          <section className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-3">
            <div className="card">
              <h3 className="font-medium mb-2">Datos</h3>
              <div className="space-y-2">
                <label className="block text-sm">Nombre<input className="w-full mt-1 bg-transparent border border-slate-600 rounded px-2 py-1" value={name} onChange={e=>setName(e.target.value)} /></label>
                <div className="grid grid-cols-2 gap-2">
                  <label className="text-sm">Fecha nacimiento<input type="date" className="w-full mt-1 bg-transparent border border-slate-600 rounded px-2 py-1" value={date} onChange={e=>setDate(e.target.value)} /></label>
                  <label className="text-sm">Hora<input type="time" className="w-full mt-1 bg-transparent border border-slate-600 rounded px-2 py-1" value={time} onChange={e=>setTime(e.target.value)} /></label>
                </div>
                <label className="block text-sm">Huso (±HH:MM)<input className="w-full mt-1 bg-transparent border border-slate-600 rounded px-2 py-1" value={tz} onChange={e=>setTz(e.target.value)} /></label>
                <label className="block text-sm">Fecha objetivo<input type="date" className="w-full mt-1 bg-transparent border border-slate-600 rounded px-2 py-1" value={target} onChange={e=>setTarget(e.target.value)} /></label>
              </div>
            </div>

            <div className="card">
              <h3 className="font-medium mb-2">Biorritmos ({target})</h3>
              <div className="space-y-2">
                <div className="chip"><span>Físico</span><strong>{bio.phys}%</strong></div>
                <div className="chip"><span>Emocional</span><strong>{bio.emo}%</strong></div>
                <div className="chip"><span>Intelectual</span><strong>{bio.intel}%</strong></div>
              </div>
            </div>

            <div className="card">
              <h3 className="font-medium mb-2">Sistemas</h3>
              <div className="space-y-2">
                <div className="chip"><span>Occidental</span><strong>{zodiacWest(birth)}</strong></div>
                <div className="chip"><span>Chino</span><strong>{chinese(birth.getUTCFullYear())}</strong></div>
                <div className="chip"><span>Fase lunar</span><strong>{moonPhase(when)}</strong></div>
                <div className="chip"><span>Nota</span><strong>Lúdico / aproximado</strong></div>
              </div>
            </div>

            <div className="card">
              <h3 className="font-medium mb-2">Top 5 días próximos</h3>
              <ol className="space-y-1 list-decimal ml-5">
                {topDays.map((d,i)=>(
                  <li key={i} className="flex justify-between gap-2">
                    <span>{d.date}</span>
                    <span className="text-green-300">{d.avg}%</span>
                  </li>
                ))}
              </ol>
            </div>
          </section>

          <section className="card">
            <h3 className="font-medium mb-2">30 días (vista rápida)</h3>
            <div className="overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead className="text-slate-300">
                  <tr><th className="text-left p-2">Fecha</th><th className="text-right p-2">F</th><th className="text-right p-2">E</th><th className="text-right p-2">I</th><th className="text-right p-2">Avg</th></tr>
                </thead>
                <tbody>
                  {Array.from({length:30},(_,i)=>{
                    const d=new Date(when); d.setDate(when.getDate()+i);
                    const b=biorhythm(birth,d); const avg=Math.round((b.phys+b.emo+b.intel)/3);
                    return (
                      <tr key={i} className="border-b border-slate-700/50">
                        <td className="p-2">{d.toISOString().slice(0,10)}</td>
                        <td className="p-2 text-right">{b.phys}%</td>
                        <td className="p-2 text-right">{b.emo}%</td>
                        <td className="p-2 text-right">{b.intel}%</td>
                        <td className="p-2 text-right"><strong className={avg>=70?'text-green-400':avg>=40?'text-yellow-300':'text-red-300'}>{avg}%</strong></td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </section>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
